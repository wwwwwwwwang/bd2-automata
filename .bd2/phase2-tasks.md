# Phase 2: CRUD 契约规范化 - 详细任务清单

## 概述
统一所有资源端点的请求/响应格式，确保列表返回 `{items, meta}`，详情/增改删返回单对象；ID 处理遵循“DB 自增 + parseId safe-integer gate”。

---

## Task 2.1: 标准化列表响应格式

### 目标
所有列表端点返回 `{ items: T[], meta: { total: number, page?: number, limit?: number } }`。

### 验收标准
- [ ] 所有列表接口响应包含 `items` 与 `meta`。
- [ ] `meta.total` 语义一致。

---

## Task 2.2: 标准化详情/增改删响应格式

### 目标
所有详情/增改删端点返回单对象（或删除返回约定状态）。

### 验收标准
- [ ] 详情/创建/更新响应为单对象。
- [ ] 删除响应行为一致（200/204 按统一约定）。

---

## Task 2.3: ID 参数处理统一

### 目标
所有路由中的业务 ID 参数均通过 `parseId` 处理为安全整数。

### 实施步骤
1. path/query/body 的 ID 参数先做数字字符串校验。
2. 调用 `parseId` 进行 safe-integer 校验。
3. service 层使用 number 语义处理 ID。

### 验收标准
- [ ] 非法 ID 返回 400。
- [ ] 合法 ID 可正常查询/更新/删除。

---

## Task 2.4: 实现用户资源 CRUD

### 验收标准
- [ ] 用户 CRUD + 分页链路通过。
- [ ] 删除后行为符合软删策略。

---

## Task 2.5: 实现角色资源 CRUD

### 验收标准
- [ ] 角色 CRUD + 分页链路通过。
- [ ] 删除后行为符合软删策略。

---

## Task 2.6: 实现权限资源 CRUD

### 验收标准
- [ ] 权限 CRUD + 分页链路通过。
- [ ] 删除后行为符合软删策略。

---

## Task 2.7: 实现用户-角色关联接口

### 验收标准
- [ ] 分配/移除/查询关联流程通过。
- [ ] 关联查询不泄漏软删实体。

---

## Task 2.8: 实现角色-权限关联接口

### 验收标准
- [ ] 分配/移除/查询关联流程通过。
- [ ] 关联查询不泄漏软删实体。

---

## Task 2.9: 编写 Phase 2 契约测试

### 测试要点
1. 列表响应格式一致。
2. 详情/增改删响应格式一致。
3. ID 参数校验一致（parseId safe-integer）。

### 验收标准
- [ ] 测试覆盖 users/roles/permissions/关联接口。
- [ ] 契约测试全部通过。

---

## Phase 2 完成标准

- [ ] Task 2.1-2.9 验收通过。
- [ ] 响应契约与 ID 处理策略一致。
